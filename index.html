<!doctype html>
<html lang="en">
    <head>
        <meta charset="utf-8" />
        <link rel="stylesheet" href="mahe-lab_style.css">
        <title>MAHELAB Standard Operating Procedures</title>
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <script type="text/javascript">
			window.onload = run();
			async function* makeTextFileLineIterator(fileURL) {
				const response = await fetch(fileURL);
				if (!response.ok) {
					throw new Error(`Response status: ${response.status}`);
				}
				const reader = response.body.pipeThrough(new TextDecoderStream()).getReader();
				let { value: chunk, done: readerDone } = await reader.read();
				chunk = chunk || "";
				const newsection = /## /gm;
				let startIndex = 0;
				let result;
				while (true) {
					const result = newsection.exec(chunk);
					if (!result) {
						if (readerDone) break;
						const remainder = chunk.substr(startIndex);
						({ value: chunk, done: readerDone } = await reader.read());
						chunk = remainder + (chunk || "");
						startIndex = newsection.lastIndex = 0;
						continue;
					}
					yield chunk.substring(startIndex, result.index);
					startIndex = newsection.lastIndex;
				}
				if (startIndex < chunk.length) {
					yield chunk.substring(startIndex);
				}
			}
			async function run() {
				for await (const section of makeTextFileLineIterator('https://mahe-lab.github.io/sops/README.md')) {
					processLine(section);
				}
			}
			function processLine(section) {
				let [first, ...rest] = section.split('\n');
		                let newDiv = document.createElement('div');
		                newDiv.innerHTML += "<h2>" + first.replace(":","") + "<\/h2><br>";
		                for(i=0; i<rest.length; i++) {
			                if(rest[i] !== "") {
						let link_name = rest[i].match(/^\[([\s\S]*?)]/g);
						let name = (link_name[0].replace("\[","")).replace("\]","");
				                let md_file = rest[i].match(/\(([\s\S]*?)\)/g);
						let file = (md_file[0].replace("\(","")).replace("\)","");
				                console.log(name)
				                console.log(file)
						newDiv.innerHTML += '<a href=\"https://mahe-lab.github.io/sops/sop_template.html?' + file + '\">' + name + '<\/a><br>';
					}
				}
				newDiv.innerHTML += "<br><br>";
				document.body.appendChild(newDiv);
			}
		</script>  
    </head>
    <body>
    </body>
    <footer>
	      	<br>
		<h5><b>MAHELAB</b> | A Translational Research Laboratory of Charbonneau Cancer Institute | Cumming School of Medicine | University of Calgary<br>
		Copyright &copy; 2024 All Rights Reserved by Etienne Mahe | <a href="mailto:ermahe@ucalgary.ca">Contact</a></h5>
	    	<br>
	</footer>
</html>
